# Компонент Markdown

Компонент для преобразования текста в формате Markdown в валидный HTML с использованием библиотеки Parsedown. Реализует полную поддержку синтаксиса Markdown с интеграцией компонента Code для подсветки синтаксиса блоков кода.

> **Внимание!** Компонент Markdown требует обязательной установки библиотеки Parsedown.

```bash
composer require erusev/parsedown
```

Без этой зависимости компонент не будет работать и выбросит исключение `RuntimeException`.

## Характеристики

| Параметр | Значение |
|----------|----------|
| **Тип компонента** | Контентный компонент |
| **Иммутабельность** | Да (readonly) |
| **Рендеринг** | SSR (серверный) |
| **Типизация** | Strict PHP 8.2+ |
| **CSS префикс** | `wallkit-` |
| **Зависимости** | Base, WithInheritance, Parsedown |
| **Внешняя зависимость** | erusev/parsedown |

## Поддерживаемый синтаксис Markdown

| Элемент | Пример | Описание |
|---------|--------|----------|
| **Заголовки** | `# H1` `## H2` | 6 уровней заголовков |
| **Абзацы** | Текст | Автоматическое форматирование |
| **Списки** | `- элемент` `1. элемент` | Маркированные и нумерованные |
| **Выделение** | `**жирный**` `*курсив*` | Жирный и курсивный текст |
| **Ссылки** | `[текст](url)` | Гиперссылки |
| **Изображения** | `![alt](url)` | Изображения с подписью |
| **Блоки кода** | ```php\nкод\n``` | С подсветкой синтаксиса |
| **Инлайн код** | `` `код` `` | Встроенный код |
| **Цитаты** | `> цитата` | Блоки цитирования |
| **Таблицы** | `\| столбец \|` | Табличные данные |
| **Горизонтальные линии** | `---` | Разделители |
| **Зачеркнутый текст** | `~~текст~~` | Удаленный текст |
| **Вставленный текст** | `++текст++` | Добавленный текст |
| **Выделенный текст** | `==текст==` | Выделение маркером |

## Свойства компонента

| Свойство | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `content` | `string` | — | Markdown-контент для преобразования (обязательно) |
| `safeMode` | `bool` | `true` | Безопасный режим (экранирование HTML) |
| `options` | `array` | `[]` | Дополнительные опции парсера Parsedown |

### Дополнительные опции парсера

```php
// Примеры доступных опций
$options = [
    'setBreaksEnabled' => true,      // Преобразование переносов в <br>
    'setUrlsLinked' => true,         // Автоматическое преобразование URL в ссылки
    'setMarkupEscaped' => false,     // Экранирование HTML-разметки
    'setSafeMode' => true,           // Безопасный режим (переопределяет safeMode)
];
```

## Использование

### Базовое использование
```php
use OlegV\WallKit\Content\Markdown\Markdown;

$md = new Markdown('# Заголовок документа');
echo $md;
```

### Полный документ
```php
$document = new Markdown(<<<'MD'
# Основной заголовок

Это **жирный текст** и *курсивный*.

## Подзаголовок

- Первый элемент списка
- Второй элемент списка
- Третий элемент списка

### Код

MD);

echo $document;
```

### Инлайн-рендеринг
```php
$inline = new Markdown('**Жирный текст** и `код`');
echo $inline->toInlineHtml(); // Без блоковых элементов
```

### Безопасный режим
```php
$safe = new Markdown(
    content: '<script>alert("XSS")</script>',
    safeMode: true // HTML будет экранирован
);
```

## Интеграция с компонентом Code

Компонент Markdown автоматически использует компонент `Code` для рендеринга блоков кода:
- Блоки кода с указанием языка (` ```lang `) преобразуются в компонент Code
- Автоматическая подсветка синтаксиса
- Номера строк для длинного кода (>250 символов)
- Кнопка копирования кода
- Метка с названием языка

### Пользовательские настройки Code
Настройки рендеринга блоков кода определяются в `ParsedownEx`:
```php
$codeComponent = new Code(
    content: $code,
    language: $language,
    highlight: true,
    lineNumbers: strlen($code) > 250,
    copyButton: true,
    showLanguage: $language !== 'text',
);
```

## Стилизация

### CSS-классы
| Класс | Назначение |
|-------|------------|
| `.wallkit-markdown` | Базовый контейнер Markdown |
| `.wallkit-markdown h1-h6` | Заголовки всех уровней |
| `.wallkit-markdown code` | Инлайн-код |
| `.wallkit-markdown pre` | Блоки кода (без компонента Code) |
| `.wallkit-markdown blockquote` | Цитаты |
| `.wallkit-markdown table` | Таблицы |
| `.wallkit-markdown .footnotes` | Сноски (ParsedownExtra) |

### CSS-переменные
Компонент использует переменные из базовой темы:
- `--wk-color-*` — цвета текста и фона
- `--wk-color-gray-*` — градации серого
- `--wk-color-blue-*` — цвета ссылок
- `--wk-color-green-*` — вставленный текст
- `--wk-color-yellow-*` — выделенный текст
- `--wk-spacing-*` — отступы и поля
- `--wk-font-*` — типографика
- `--wk-radius-*` — радиусы скругления

## Совместимость

| Система | Статус | Примечания |
|---------|--------|------------|
| **PHP** | 8.2+ | Strict типизация, readonly классы |
| **Parsedown** | 1.7+ | Обязательная зависимость |
| **HTML** | 5+ | Семантическая разметка |
| **CSS** | 3+ | CSS-переменные, каскадные селекторы |
| **JavaScript** | ES6+ | Не требуется для базовой работы |

## Требования к установке

```bash
# Обязательная зависимость для Markdown
composer require erusev/parsedown

# Дополнительная зависимость для подсветки кода
composer require scrivo/highlight.php
```

## Ссылки
- [Базовый класс Base](../Base/README.md)
- [Компонент Code](../Code/README.md)
- [Parsedown](https://github.com/erusev/parsedown/)
- [Руководство по стилизации](../../../styling.md)

---

**Версия:** 1.0.0  
**Зависимость:** erusev/parsedown  
**Автор:** OlegV  
**Лицензия:** MIT